@typeparam TItem where TItem : class

<div class="auto-data-grid-content">
    <div class="auto-data-grid-area">
        <FluentDataGrid @ref="@Grid" TGridItem="TItem" Items="@Items" DisplayMode="DataGridDisplayMode.Grid" ShowHover="true" Pagination="@pagination" GridTemplateColumns="@GridTemplateColumns" GenerateHeader="GenerateHeaderOption.Sticky">
            <ChildContent>
                <SelectColumn TGridItem="TItem" @bind-SelectedItems="@SelectedItems" SelectMode="DataGridSelectMode.Single" />
                @ChildContent
            </ChildContent>

            <LoadingContent>
                @if (LoadingContent != null)
                {
                    @LoadingContent
                }
                else
                {
                    <FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Center" VerticalAlignment="VerticalAlignment.Center">
                        <FluentProgressRing Size="16" />
                        <FluentLabel>Loading items...</FluentLabel>
                    </FluentStack>
                }
            </LoadingContent>

            <EmptyContent>
                @if (EmptyContent != null)
                {
                    @EmptyContent
                }
                else
                {
                    <FluentStack Orientation="Orientation.Horizontal" HorizontalAlignment="HorizontalAlignment.Center" VerticalAlignment="VerticalAlignment.Center">
                        <FluentIcon Value="@(new Icons.Regular.Size16.Info())" />
                        <FluentLabel>No items found.</FluentLabel>
                    </FluentStack>
                }
            </EmptyContent>
        </FluentDataGrid>
    </div>
    <div class="auto-data-grid-pager-area">
        <FluentPaginator State="@pagination" />
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public IQueryable<TItem>? Items { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public RenderFragment? LoadingContent { get; set; }

    [Parameter]
    public RenderFragment? EmptyContent { get; set; }

    [Parameter, EditorRequired]
    public string GridTemplateColumns { get; set; } = default!;

    [Parameter]
    public int ItemsPerPage { get; set; } = 50;

    [Parameter]
    public IEnumerable<TItem> SelectedItems
    {
        get => _selectedItems;
        set
        {
            _selectedItems = value;
            SelectedItemsChanged.InvokeAsync(value);
        }
    }
    private IEnumerable<TItem> _selectedItems = [];

    [Parameter]
    public EventCallback<IEnumerable<TItem>> SelectedItemsChanged { get; set; }

    private FluentDataGrid<TItem>? Grid { get; set; }
    private readonly PaginationState pagination = new();

    protected override async Task OnParametersSetAsync()
    {
        pagination.ItemsPerPage = ItemsPerPage;
        await base.OnParametersSetAsync();
    } 

    public async Task RefreshAsync() => await Grid!.RefreshDataAsync();

    public void SetLoadingState(bool? loading) => Grid?.SetLoadingState(loading);
}
